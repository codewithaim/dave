{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="{% static 'upload/public/styles.css' %}">
    <title>Home</title>
</head>
<body class="bg-gray-50">

    <!-- Navbar -->
    <nav class="bg-teal-600 py-4 shadow-lg">
        <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <a href="#" class="font-bold text-xl text-white text-center md:text-left">
                DAVE - Data Analysis & Visualization Engine
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="container mx-auto bg-gray-100 rounded-lg p-6 md:p-8 my-6 text-center md:text-left">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-medium text-teal-600">
            Hi! Ready to analyze your data?
        </h1>
        <p class="mt-2 sm:mt-4 text-gray-700 text-sm sm:text-base lg:text-lg">
            Upload your template below and let DAVE quickly visualize it for you.
        </p>
    </div>

    <!-- Upload Section -->
    <div class="container mx-auto flex flex-col md:flex-row gap-6 md:gap-8 my-6">
        <!-- Upload Form -->
        <div class="md:w-1/2 bg-white rounded-lg shadow p-6 flex flex-col justify-center">
            <h2 class="text-teal-600 font-bold text-lg mb-4 text-center md:text-left">
                Upload a CSV File
            </h2>
            <form class="flex flex-col gap-4" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input class="border border-gray-300 rounded px-3 py-2 w-full" type="file" name="filename" id="filename">
                <button class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded w-full md:w-auto" type="submit">
                    Upload
                </button>
            </form>
        </div>

        <!-- Optional Right Content -->
        <div class="md:w-1/2 flex items-center justify-center text-gray-500 text-sm sm:text-base">
            <p class="text-center md:text-left"></p>
        </div>
    </div>

    <!-- Data Table Section -->
    <div class="container mx-auto my-6">
        <h2 class="text-teal-600 font-bold text-lg mb-4 text-center md:text-left">Data From File</h2>
        <div class="overflow-x-auto">
            <table id="data-table" class="min-w-full bg-white border border-gray-200 rounded-lg shadow">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Property Name</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Price</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Rent</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">EMI</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Tax</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Other Expenses</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Net Expenses</th>
                        <th class="px-3 sm:px-4 py-2 text-left text-xs sm:text-sm text-gray-500">Net Income</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in data_objects %}
                    <tr class="border-t hover:bg-gray-50">
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm font-bold text-gray-700">{{ data.property_name }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-green-500">{{ data.property_price }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-green-500">{{ data.property_rent }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-red-500">{{ data.emi }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-red-500">{{ data.tax }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-red-500">{{ data.other_exp }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-red-500">{{ data.monthly_expenses }}</td>
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-green-500">{{ data.monthly_income}}</td>
                    </tr>
                    {% endfor %}
                    <tr class="border-t font-bold bg-gray-50">
                        <td class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">Total</td>
                        <td id="total-price" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                        <td id="total-rent" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                        <td id="total-emi" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                        <td id="total-tax" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                        <td id="total-other-exp" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                        <td id="total-net-expenses" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                        <td id="total-net-income" class="px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-700">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="container mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 my-10">
        <div class="bg-white rounded-lg shadow p-6 flex flex-col">
            <h3 class="text-teal-600 font-bold mb-4 text-center md:text-left">Income Chart</h3>
            <div class="w-full">
                <canvas id="incomeChart" class="w-full h-64 md:h-80"></canvas>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 flex flex-col">
            <h3 class="text-teal-600 font-bold mb-4 text-center md:text-left">Expenses Chart</h3>
            <div class="w-full">
                <canvas id="expenseChart" class="w-full h-64 md:h-80"></canvas>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 flex flex-col">
            <h3 class="text-teal-600 font-bold mb-4 text-center md:text-left">Income Spread Chart</h3>
            <div class="w-full">
                <canvas id="incomeSpreadChart" class="w-full h-64 md:h-80"></canvas>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 flex flex-col">
            <h3 class="text-teal-600 font-bold mb-4 text-center md:text-left">Expense Spread Chart</h3>
            <div class="w-full">
                <canvas id="expenseSpreadChart" class="w-full h-64 md:h-80"></canvas>
            </div>
        </div>
    </div>

    <!-- Keep all your <script> code as-is -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Your existing JS for table totals and charts
        const table = document.querySelector("#data-table");
        let total_price = 0, total_rent = 0, total_emi = 0, total_tax = 0, total_other_exp = 0, total_net_expenses = 0, total_net_income = 0;
        const totalPrice = document.querySelector("#total-price");
        const totalRent = document.querySelector("#total-rent");
        const totalEmi = document.querySelector("#total-emi");
        const totalTax = document.querySelector("#total-tax");
        const totalOtherExp = document.querySelector("#total-other-exp");
        const totalNetExpenses = document.querySelector("#total-net-expenses");
        const totalNetIncome = document.querySelector("#total-net-income");

        let net_incomes = [], net_expenses = [], property_names = [];
        let net_emis = [], net_taxes = [], net_other_exps =[];

        for(let i = 1; i < table.rows.length - 1; i++) {
            property_names.push(table.rows[i].cells[0].innerText);
            total_price += parseInt(table.rows[i].cells[1].innerText);   
            total_rent += parseInt(table.rows[i].cells[2].innerText);   
            total_emi += parseInt(table.rows[i].cells[3].innerText);   
            net_emis.push(parseInt(table.rows[i].cells[3].innerText));
            total_tax += parseInt(table.rows[i].cells[4].innerText);   
            net_taxes.push(parseInt(table.rows[i].cells[4].innerText));
            total_other_exp += parseInt(table.rows[i].cells[5].innerText);   
            net_other_exps.push(parseInt(table.rows[i].cells[5].innerText));
            total_net_expenses += parseInt(table.rows[i].cells[6].innerText); 
            net_expenses.push(parseInt(table.rows[i].cells[6].innerText));   
            total_net_income += parseInt(table.rows[i].cells[7].innerText);
            net_incomes.push(parseInt(table.rows[i].cells[7].innerText));   
        }

        totalPrice.innerText = total_price;
        totalRent.innerText = total_rent;
        totalEmi.innerText = total_emi;
        totalTax.innerText = total_tax;
        totalOtherExp.innerText = total_other_exp;
        totalNetExpenses.innerText = total_net_expenses;
        totalNetIncome.innerText = total_net_income;


        document.addEventListener('DOMContentLoaded', function() {
            const ctxIncome = document.getElementById('incomeChart');

            new Chart(ctxIncome, {
                type: 'bar',
                data: {
                labels: property_names,
                datasets: [{
                    label: 'Income in dollars',
                    data: net_incomes,
                    borderWidth: 1
                }]
                },
                options: {
                scales: {
                    y: {
                    beginAtZero: true
                    }
                }
                }
            });
        });

        // Expense Chart
        document.addEventListener('DOMContentLoaded', function() {
            const ctxExpense = document.getElementById('expenseChart');

            new Chart(ctxExpense, {
                type: 'bar',
                data: {
                labels: property_names,
                datasets: [{
                    label: 'Expenses in dollars',
                    data: net_expenses,
                    borderWidth: 1
                }]
                },
                options: {
                scales: {
                    y: {
                    beginAtZero: true
                    }
                }
                }
            });
        });

        // Income Spread Chart

        document.addEventListener('DOMContentLoaded', function() {
            const ctxIncomeSpread = document.getElementById('incomeSpreadChart');

            new Chart(ctxIncomeSpread, {
                type: 'doughnut',
                data: {
                labels: property_names,
                datasets: [{
                    label: 'Monthly Incomes',
                    data: net_incomes,
                    borderWidth: 1
                }
                ]
                },
                options: {
                responsive: true,
  maintainAspectRatio: false
                }
            });
        });

        // Expenses Spread Chart
        document.addEventListener('DOMContentLoaded', function() {
            const ctxExpenseSpread = document.getElementById('expenseSpreadChart');

            new Chart(ctxExpenseSpread, {
                type: 'bar',
                data: {
                labels: property_names,
                datasets: [{
                    label: 'Monthly EMI',
                    data: net_emis,
                    borderWidth: 1
                },
                {
                    label: 'Monthly Tax',
                    data: net_taxes,
                    borderWidth: 1
                },
                {
                    label: 'Monthly Other Expenses',
                    data: net_other_exps,
                    borderWidth: 1
                }]
                },
                options: {
                scales: {
                    y: {
                    beginAtZero: true
                    }
                }
                }
            });
        });



    </script>
</body>
</html>
